<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chord Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0c0a;
    --surface: #161410;
    --surface2: #1e1c18;
    --border: #2e2b24;
    --gold: #c9a84c;
    --gold-dim: #7a6530;
    --cream: #e8e0cc;
    --muted: #6b6450;
    --funk: #d4633a;
    --jazz: #4a8fa8;
    --math: #9b6fd4;
    --text: #cfc8b4;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; min-height: 100vh; padding: 2rem; }
  .grain {
    position: fixed; inset: 0; pointer-events: none; z-index: 100;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    opacity: 0.4;
  }
  header { text-align: center; margin-bottom: 2.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border); }
  h1 { font-family: 'Playfair Display', serif; font-size: clamp(2rem,5vw,3.2rem); color: var(--cream); letter-spacing: -0.02em; line-height: 1; }
  h1 em { color: var(--gold); font-style: italic; }
  .subtitle { font-size: 0.7rem; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-top: 0.5rem; }
  .controls { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; justify-content: center; margin-bottom: 2rem; }
  .control-group { display: flex; flex-direction: column; gap: 0.3rem; }
  label { font-size: 0.6rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); }
  select, button {
    background: var(--surface2); border: 1px solid var(--border); color: var(--text);
    font-family: 'IBM Plex Mono', monospace; font-size: 0.85rem; padding: 0.6rem 1rem;
    cursor: pointer; outline: none; transition: all 0.2s; border-radius: 2px;
  }
  select:hover, select:focus { border-color: var(--gold-dim); color: var(--cream); }
  .btn-generate { background: var(--gold); color: var(--bg); font-weight: 500; border-color: var(--gold); padding: 0.6rem 2rem; letter-spacing: 0.08em; font-size: 0.75rem; text-transform: uppercase; }
  .btn-generate:hover { background: var(--cream); border-color: var(--cream); }
  .vibe-toggle { display: flex; }
  .vibe-btn { border-radius: 0; font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; padding: 0.6rem 1.1rem; }
  .vibe-btn:not(:last-child) { border-right: none; }
  .vibe-btn.active.jazz { background: var(--jazz); color: var(--bg); border-color: var(--jazz); }
  .vibe-btn.active.mix  { background: var(--gold); color: var(--bg); border-color: var(--gold); }
  .vibe-btn.active.funk { background: var(--funk); color: var(--bg); border-color: var(--funk); }
  .vibe-btn.active.math { background: var(--math); color: var(--bg); border-color: var(--math); }
  #output { max-width: 1100px; margin: 0 auto; opacity: 0; transition: opacity 0.4s; }
  #output.visible { opacity: 1; }
  .section-title {
    font-size: 0.65rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--gold);
    margin-bottom: 1rem; display: flex; align-items: center; gap: 0.8rem;
  }
  .section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .chords-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px,1fr)); gap: 1.2rem; margin-bottom: 2.5rem; }
  .chord-card {
    background: var(--surface); border: 1px solid var(--border);
    padding: 1rem 0.8rem; text-align: center;
    transition: border-color 0.2s, transform 0.15s; cursor: default;
  }
  .chord-card:hover { transform: translateY(-2px); }
  .chord-name { font-family: 'Playfair Display', serif; font-size: 1.1rem; color: var(--cream); margin-bottom: 0.2rem; }
  .chord-type-tag { font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.6rem; }
  .chord-type-tag.jazz { color: var(--jazz); }
  .chord-type-tag.funk { color: var(--funk); }
  .chord-type-tag.math { color: var(--math); }
  .chord-type-tag.mix  { color: var(--gold); }
  .chord-intervals { font-size: 0.6rem; color: var(--muted); margin-top: 0.5rem; letter-spacing: 0.05em; }
  .chord-desc { font-size: 0.55rem; color: #5a4a7a; margin-top: 0.3rem; font-style: italic; }
  .key-info {
    background: var(--surface2); border: 1px solid var(--border); border-left: 3px solid var(--gold);
    padding: 1rem 1.5rem; margin-bottom: 1.5rem; display: flex; gap: 2rem; flex-wrap: wrap; align-items: center;
  }
  .key-info-item { display: flex; flex-direction: column; gap: 0.2rem; }
  .key-info-label { font-size: 0.55rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); }
  .key-info-value { font-size: 0.9rem; color: var(--cream); }
  .legend { display: flex; gap: 1.5rem; align-items: center; margin-bottom: 1.2rem; flex-wrap: wrap; }
  .legend-lbl { font-size: 0.58rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); }
  .legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.62rem; }
  .progressions-list { display: flex; flex-direction: column; gap: 0.8rem; margin-bottom: 2.5rem; }
  .progression-row {
    background: var(--surface); border: 1px solid var(--border);
    padding: 1rem 1.2rem; display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;
  }
  .prog-label { font-size: 0.6rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); min-width: 110px; flex-shrink: 0; }
  .prog-chords { display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center; flex: 1; }
  .prog-chord { background: var(--surface2); border: 1px solid var(--border); padding: 0.3rem 0.7rem; font-size: 0.8rem; color: var(--cream); font-family: 'Playfair Display', serif; }
  .prog-arrow { color: var(--border); font-size: 0.7rem; }
  .prog-feel { font-size: 0.6rem; color: var(--gold-dim); margin-left: auto; font-style: italic; }
  @keyframes fadeSlide { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:none; } }
  .chord-card { animation: fadeSlide 0.25s ease both; }
  .chord-card:nth-child(2) { animation-delay:0.04s; }
  .chord-card:nth-child(3) { animation-delay:0.08s; }
  .chord-card:nth-child(4) { animation-delay:0.12s; }
  .chord-card:nth-child(5) { animation-delay:0.16s; }
  .chord-card:nth-child(6) { animation-delay:0.20s; }
  .chord-card:nth-child(7) { animation-delay:0.24s; }
</style>
</head>
<body>
<div class="grain"></div>
<header>
  <h1>Chord <em>Files</em></h1>
  <p class="subtitle">Jazz · Funk · Math/Alt Arrangement Generator</p>
</header>
<div class="controls">
  <div class="control-group">
    <label>Root Key</label>
    <select id="keySelect">
      <option value="C">C</option><option value="Db">D&#9837;</option><option value="D">D</option>
      <option value="Eb">E&#9837;</option><option value="E">E</option><option value="F">F</option>
      <option value="F#">F&#9839;</option><option value="G">G</option><option value="Ab">A&#9837;</option>
      <option value="A">A</option><option value="Bb">B&#9837;</option><option value="B">B</option>
    </select>
  </div>
  <div class="control-group">
    <label>Mode</label>
    <select id="modeSelect">
      <option value="major">Major</option>
      <option value="minor">Minor (Dorian)</option>
      <option value="blues">Blues</option>
    </select>
  </div>
  <div class="control-group">
    <label>Vibe</label>
    <div class="vibe-toggle">
      <button class="vibe-btn jazz"       data-vibe="jazz">Jazz</button>
      <button class="vibe-btn mix active" data-vibe="mix">Mix</button>
      <button class="vibe-btn funk"       data-vibe="funk">Funk</button>
      <button class="vibe-btn math"       data-vibe="math">Math/Alt</button>
    </div>
  </div>
  <div class="control-group">
    <label>&nbsp;</label>
    <button class="btn-generate" id="generateBtn">Generate &#8594;</button>
  </div>
</div>
<div id="output"></div>

<script>
var CHROMATIC = ['C','Db','D','Eb','E','F','F#','G','Ab','A','Bb','B'];

var SCALES = {
  major: [0,2,4,5,7,9,11],
  minor: [0,2,3,5,7,9,10],
  blues: [0,3,5,6,7,10]
};

var DEGREE_NAMES = ['I','II','III','IV','V','VI','VII'];

var CHORD_QUALITIES = {
  major: [
    {sym:'maj7', intervals:[0,4,7,11], type:'jazz'},
    {sym:'m7',   intervals:[0,3,7,10], type:'jazz'},
    {sym:'m7',   intervals:[0,3,7,10], type:'jazz'},
    {sym:'maj7', intervals:[0,4,7,11], type:'jazz'},
    {sym:'7',    intervals:[0,4,7,10], type:'funk'},
    {sym:'m7',   intervals:[0,3,7,10], type:'jazz'},
    {sym:'m7b5', intervals:[0,3,6,10], type:'jazz'}
  ],
  minor: [
    {sym:'m7',   intervals:[0,3,7,10], type:'jazz'},
    {sym:'m7',   intervals:[0,3,7,10], type:'jazz'},
    {sym:'maj7', intervals:[0,4,7,11], type:'jazz'},
    {sym:'m7',   intervals:[0,3,7,10], type:'jazz'},
    {sym:'7',    intervals:[0,4,7,10], type:'funk'},
    {sym:'7',    intervals:[0,4,7,10], type:'funk'},
    {sym:'maj7', intervals:[0,4,7,11], type:'jazz'}
  ],
  blues: [
    {sym:'9',  intervals:[0,4,7,10,2], type:'funk'},
    {sym:'7',  intervals:[0,4,7,10],   type:'funk'},
    {sym:'m7', intervals:[0,3,7,10],   type:'jazz'},
    {sym:'9',  intervals:[0,4,7,10,2], type:'funk'},
    {sym:'7',  intervals:[0,4,7,10],   type:'funk'},
    {sym:'m7', intervals:[0,3,7,10],   type:'jazz'}
  ]
};

var INTERVALS_MAP = {
  'maj7':[0,4,7,11], 'm7':[0,3,7,10], '7':[0,4,7,10], 'm7b5':[0,3,6,10],
  '9':[0,4,7,10,2],  'maj9':[0,4,7,11,2], 'm9':[0,3,7,10,2],
  'sus2':[0,2,7], 'sus4':[0,5,7], 'add9':[0,4,7,2], 'qrt':[0,5,10],
  '5':[0,7], 'maj7sus2':[0,2,7,11], 'm(add9)':[0,3,7,2]
};

var MATH_TYPES = [
  {sym:'sus2',     intervals:[0,2,7],    name:'Suspended 2', str:'R  2  5',     desc:'open, floating'},
  {sym:'sus4',     intervals:[0,5,7],    name:'Suspended 4', str:'R  4  5',     desc:'unresolved tension'},
  {sym:'add9',     intervals:[0,4,7,2],  name:'Add 9',       str:'R  3  5  9',  desc:'bright, wide'},
  {sym:'qrt',      intervals:[0,5,10],   name:'Quartal',     str:'R  4  b7',    desc:'stacked 4ths — angular jazz'},
  {sym:'5',        intervals:[0,7],      name:'Power / No 3',str:'R  5',        desc:'raw, ambiguous'},
  {sym:'maj7sus2', intervals:[0,2,7,11], name:'Maj7 sus2',   str:'R  2  5  7',  desc:'ethereal shimmer'},
  {sym:'m(add9)',  intervals:[0,3,7,2],  name:'Minor add9',  str:'R  b3  5  9', desc:'melancholic + color'}
];

var OPEN_SEMI = [4,9,2,7,11,4];

function noteAt(idx) { return CHROMATIC[(idx % 12 + 12) % 12]; }

function getScaleNotes(root, mode) {
  var ri = CHROMATIC.indexOf(root);
  return SCALES[mode].map(function(iv){ return noteAt(ri+iv); });
}

function buildShape(root, sym) {
  var r = CHROMATIC.indexOf(root);
  var aRoot = ((r-5+12)%12);
  var dRoot = ((r-10+12)%12);
  var s = {};
  if (aRoot <= 9) {
    s['maj7'] = [-1,aRoot,aRoot+2,aRoot+6,aRoot+6,aRoot+5];
    s['m7']   = [-1,aRoot,aRoot+2,aRoot+5,aRoot+5,aRoot+3];
    s['7']    = [-1,aRoot,aRoot+2,aRoot+6,aRoot+5,aRoot+3];
  } else {
    s['maj7'] = [-1,-1,dRoot,dRoot+4,dRoot+4,dRoot+3];
    s['m7']   = [-1,-1,dRoot,dRoot+3,dRoot+3,dRoot+3];
    s['7']    = [-1,-1,dRoot,dRoot+4,dRoot+3,dRoot+3];
  }
  if (aRoot <= 7) {
    s['9']  = [-1,aRoot,aRoot+2,aRoot+1,aRoot+3,aRoot+2];
    s['m9'] = [-1,aRoot,aRoot+2,aRoot+0,aRoot+3,aRoot+2];
  } else {
    s['9']  = [-1,-1,dRoot,dRoot+1,dRoot+3,dRoot+2];
    s['m9'] = [-1,-1,dRoot,dRoot+0,dRoot+3,dRoot+2];
  }
  if (aRoot <= 9) {
    s['m7b5'] = [-1,aRoot,aRoot+1,aRoot+5,aRoot+4,aRoot+3];
  } else {
    s['m7b5'] = [-1,-1,dRoot,dRoot+0,dRoot+4,dRoot+3];
  }
  if (s[sym]) return s[sym];
  var tones = (INTERVALS_MAP[sym]||[0,4,7,10]).map(function(iv){ return (r+iv)%12; });
  return OPEN_SEMI.map(function(os){
    for (var f=0;f<=9;f++) if (tones.indexOf((os+f)%12)>=0) return f;
    return -1;
  });
}

function buildMathShape(root, sym) {
  var r = CHROMATIC.indexOf(root);
  var a = ((r-5+12)%12), d = ((r-10+12)%12), e = r%12;
  var s = {
    'sus2':     a<=9 ? [-1,a,a+2,a+4,a+2,-1]      : [-1,-1,d,d+2,d+3,d+2],
    'sus4':     a<=9 ? [-1,a,a+2,a+2,a+3,-1]      : [-1,-1,d,d+2,d+3,d+3],
    'add9':     a<=7 ? [-1,a,a+2,a+4,a+2,a+2]     : [-1,-1,d,d+2,d+2,d+2],
    'qrt':      a<=5 ? [-1,a,a+5,a+10,a+8,-1]     : [-1,-1,d,d+5,d+10,d+8],
    '5':        e<=9 ? [e,e+2,e+2,-1,-1,-1]        : [-1,a,a+2,a+2,-1,-1],
    'maj7sus2': a<=7 ? [-1,a,a+2,a+6,a+2,-1]      : [-1,-1,d,d+2,d+6,d+2],
    'm(add9)':  a<=7 ? [-1,a,a+2,a+4,a+1,a+2]     : [-1,-1,d,d+2,d+0,d+2]
  };
  return s[sym] || [-1,a,a+2,a+2,a+2,-1];
}

function drawDiagram(frets, scaleSemi, chordSemi) {
  var W=138, H=160;
  var valid = frets.filter(function(f){return f>0;});
  var minF  = valid.length ? Math.min.apply(null,valid) : 1;
  var maxF  = valid.length ? Math.max.apply(null,valid) : 5;
  var start = (maxF > 5) ? Math.max(1,minF) : 1;
  var rows  = 5;
  var pT=30,pL=18,pR=12,pB=22;
  var sW = (W-pL-pR)/5;
  var fH = (H-pT-pB)/rows;

  var o = '<svg width="'+W+'" height="'+H+'" viewBox="0 0 '+W+' '+H+'" xmlns="http://www.w3.org/2000/svg">';

  // Nut / position marker
  if (start===1) {
    o += '<rect x="'+pL+'" y="'+(pT-5)+'" width="'+(sW*5)+'" height="5" fill="#c9a84c" rx="1"/>';
  } else {
    o += '<text x="'+(pL-6)+'" y="'+(pT+fH*0.65)+'" font-size="8" fill="#6b6450" font-family="IBM Plex Mono" text-anchor="end">'+start+'</text>';
  }

  // Fret lines
  for (var f=0;f<=rows;f++) {
    var fy=pT+f*fH;
    o += '<line x1="'+pL+'" y1="'+fy+'" x2="'+(pL+sW*5)+'" y2="'+fy+'" stroke="'+(f>0&&f<rows?'#252320':'#2e2b24')+'" stroke-width="'+(f>0&&f<rows?'0.8':'1')+'"/>';
  }
  // String lines
  for (var s=0;s<6;s++) {
    var sx=pL+s*sW;
    o += '<line x1="'+sx+'" y1="'+pT+'" x2="'+sx+'" y2="'+(pT+fH*rows)+'" stroke="#2a2822" stroke-width="1.2"/>';
  }

  // Build chord fret lookup
  var cfl={};
  frets.forEach(function(fv,si){ cfl[si+'-'+fv]=true; });

  // Ghost scale dots
  for (var s2=0;s2<6;s2++) {
    for (var rf=1;rf<=rows;rf++) {
      var af=start-1+rf;
      var nt=(OPEN_SEMI[s2]+af)%12;
      if (!cfl[s2+'-'+af] && scaleSemi.indexOf(nt)>=0 && chordSemi.indexOf(nt)<0) {
        var gx=pL+s2*sW, gy=pT+(rf-0.5)*fH, gr=fH*0.26;
        o += '<circle cx="'+gx+'" cy="'+gy+'" r="'+gr+'" fill="none" stroke="#4a5a4a" stroke-width="1" opacity="0.7"/>';
        o += '<text x="'+gx+'" y="'+(gy+3.5)+'" text-anchor="middle" font-size="6.5" fill="#5a7a5a" font-family="IBM Plex Mono" opacity="0.85">'+CHROMATIC[nt]+'</text>';
      }
    }
  }

  // Chord dots
  frets.forEach(function(fv,i) {
    var cx=pL+i*sW, ty=pT-18;
    if (fv===-1) {
      o += '<text x="'+cx+'" y="'+(ty+12)+'" text-anchor="middle" font-size="10" fill="#2e2b24" font-family="IBM Plex Mono">&#215;</text>';
    } else if (fv===0) {
      var on=OPEN_SEMI[i]%12;
      if (chordSemi.indexOf(on)>=0) {
        o += '<circle cx="'+cx+'" cy="'+(ty+8)+'" r="5" fill="none" stroke="#c9a84c" stroke-width="1.5"/>';
      } else if (scaleSemi.indexOf(on)>=0) {
        o += '<circle cx="'+cx+'" cy="'+(ty+8)+'" r="4" fill="none" stroke="#4a5a4a" stroke-width="1" opacity="0.7"/>';
        o += '<text x="'+cx+'" y="'+(ty+11)+'" text-anchor="middle" font-size="5.5" fill="#5a7a5a" font-family="IBM Plex Mono">'+CHROMATIC[on]+'</text>';
      } else {
        o += '<circle cx="'+cx+'" cy="'+(ty+8)+'" r="4" fill="none" stroke="#3a3830" stroke-width="1"/>';
      }
    } else {
      var df=fv-start+1;
      if (df>=1 && df<=rows) {
        var dy=pT+(df-0.5)*fH, dr=fH*0.3;
        o += '<circle cx="'+cx+'" cy="'+dy+'" r="'+dr+'" fill="#c9a84c"/>';
        if (chordSemi[0]!==undefined && (OPEN_SEMI[i]+fv)%12===chordSemi[0]) {
          o += '<circle cx="'+cx+'" cy="'+dy+'" r="'+(dr*0.38)+'" fill="#0d0c0a"/>';
        }
      }
    }
  });

  var lbls=['E','A','D','G','B','e'];
  for (var lb=0;lb<6;lb++) {
    o += '<text x="'+(pL+lb*sW)+'" y="'+(pT+fH*rows+14)+'" text-anchor="middle" font-size="7.5" fill="#2e2b24" font-family="IBM Plex Mono">'+lbls[lb]+'</text>';
  }
  o += '</svg>';
  return o;
}

function buildChordCards(key, mode, vibe, scaleSemi) {
  var notes = getScaleNotes(key, mode);
  var quals = CHORD_QUALITIES[mode] || CHORD_QUALITIES.major;
  return notes.slice(0,quals.length).map(function(note,i){
    var q=quals[i], sym=q.sym;
    var ri=CHROMATIC.indexOf(note);
    var chordSemi=(INTERVALS_MAP[sym]||[0,4,7,10]).map(function(iv){return (ri+iv)%12;});
    var iStr={'maj7':'R  3  5  7','m7':'R  b3 5  b7','7':'R  3  5  b7','m7b5':'R  b3 b5 b7','9':'R  3  5  b7  9'}[sym]||'R  3  5  7';
    return {note:note,sym:sym,type:(vibe==='mix'?q.type:vibe),frets:buildShape(note,sym),iStr:iStr,degree:DEGREE_NAMES[i],chordSemi:chordSemi,desc:''};
  });
}

function buildMathCards(key, scaleSemi) {
  var ri=CHROMATIC.indexOf(key);
  return MATH_TYPES.map(function(t){
    var cs=t.intervals.map(function(iv){return (ri+(iv%12)+12)%12;});
    return {note:key,sym:t.sym,type:'math',frets:buildMathShape(key,t.sym),iStr:t.str,degree:t.name,chordSemi:cs,desc:t.desc};
  });
}

function buildProgressions(key, mode, vibe) {
  var notes=getScaleNotes(key,mode), quals=CHORD_QUALITIES[mode]||CHORD_QUALITIES.major;
  function cf(d){return {name:notes[d%notes.length]+quals[d%quals.length].sym};}
  var p=[];
  if (mode==='major'||mode==='minor') {
    if (vibe==='jazz'||vibe==='mix') {
      p.push({label:'ii – V – I',        chords:[cf(1),cf(4),cf(0)],            feel:'foundational jazz cadence'});
      p.push({label:'iii – VI – ii – V', chords:[cf(2),cf(5),cf(1),cf(4)],      feel:'extended turnaround'});
      p.push({label:'I – vi – ii – V',   chords:[cf(0),cf(5),cf(1),cf(4)],      feel:'jazz rhythm changes (A)'});
    }
    if (vibe==='funk'||vibe==='mix') {
      p.push({label:'I – IV vamp', chords:[cf(0),cf(3)], feel:'tight funk vamp — sit in the groove'});
      var bVII=noteAt(CHROMATIC.indexOf(key)-2)+(mode==='minor'?'m7':'7');
      p.push({label:'I – bVII – IV', chords:[cf(0),{name:bVII},cf(3)], feel:'funky mixolydian climb'});
    }
    if (vibe==='mix') p.push({label:'I – iii – vi – ii – V', chords:[cf(0),cf(2),cf(5),cf(1),cf(4)], feel:'jazz-funk full loop'});
  } else {
    p.push({label:'Blues I – IV – V',  chords:[cf(0),cf(3),cf(4)],         feel:'classic 12-bar foundation'});
    p.push({label:'Slow funk groove',  chords:[cf(0),cf(0),cf(3),cf(0)],   feel:'stay home, work the extensions'});
  }
  return p;
}

function buildMathProgressions(key) {
  var r=CHROMATIC.indexOf(key);
  function n(i){return CHROMATIC[(r+i+12)%12];}
  return [
    {label:'Sus vamp',       chords:[{name:key+'sus2'},{name:n(7)+'sus2'},{name:n(5)+'sus4'},{name:key+'sus2'}],            feel:'floats without resolving — Toe, Yvette Young'},
    {label:'Quartal stack',  chords:[{name:key+'qrt'},{name:n(5)+'qrt'},{name:n(10)+'qrt'},{name:n(7)+'qrt'}],             feel:'Holdsworth / McCoy Tyner — no tonal gravity'},
    {label:'bII substitution',chords:[{name:key+'sus2'},{name:n(1)+'maj7sus2'},{name:n(7)+'sus4'},{name:key+'add9'}],      feel:'tritone color — angular resolution'},
    {label:'Math cadence',   chords:[{name:key+'add9'},{name:n(9)+'m(add9)'},{name:n(5)+'sus4'},{name:n(4)+'sus2'}],       feel:'Plini / Chon — colorful but never settles'},
    {label:'Power → color',  chords:[{name:key+'5'},{name:n(7)+'5'},{name:n(3)+'add9'},{name:n(5)+'sus4'}],                feel:'raw → wide open — builds atmosphere'}
  ];
}

var currentVibe='mix';
document.querySelectorAll('.vibe-btn').forEach(function(b){
  b.addEventListener('click',function(){
    document.querySelectorAll('.vibe-btn').forEach(function(x){x.classList.remove('active');});
    b.classList.add('active');
    currentVibe=b.dataset.vibe;
  });
});

function generate() {
  var key=document.getElementById('keySelect').value;
  var mode=document.getElementById('modeSelect').value;
  var vibe=currentVibe;
  var out=document.getElementById('output');
  out.classList.remove('visible');

  setTimeout(function(){
    var ri=CHROMATIC.indexOf(key);
    var scaleSemi=SCALES[mode].map(function(iv){return (ri+iv)%12;});
    var scaleNotes=getScaleNotes(key,mode);
    var cards=(vibe==='math')?buildMathCards(key,scaleSemi):buildChordCards(key,mode,vibe,scaleSemi);
    var progs=(vibe==='math')?buildMathProgressions(key):buildProgressions(key,mode,vibe);
    var mLabel={major:'Major',minor:'Dorian Minor',blues:'Blues'}[mode];
    var vLabel={jazz:'Jazz',funk:'Funk',mix:'Jazz–Funk Mix',math:'Math / Alt'}[vibe];
    var accent={jazz:'#4a8fa8',funk:'#d4633a',mix:'#c9a84c',math:'#9b6fd4'}[vibe];

    var h='<div class="key-info" style="border-left-color:'+accent+'">';
    h+='<div class="key-info-item"><span class="key-info-label">Root</span><span class="key-info-value">'+key+'</span></div>';
    if (vibe!=='math') {
      h+='<div class="key-info-item"><span class="key-info-label">Mode</span><span class="key-info-value">'+mLabel+'</span></div>';
      h+='<div class="key-info-item"><span class="key-info-label">Scale</span><span class="key-info-value">'+scaleNotes.join('  ')+'</span></div>';
    } else {
      h+='<div class="key-info-item"><span class="key-info-label">Palette</span><span class="key-info-value">Sus · Quartal · Add9 · No3</span></div>';
      h+='<div class="key-info-item"><span class="key-info-label">Ref</span><span class="key-info-value" style="color:var(--muted);font-size:0.75rem">Toe · Plini · Chon · Holdsworth</span></div>';
    }
    h+='<div class="key-info-item"><span class="key-info-label">Vibe</span><span class="key-info-value" style="color:'+accent+'">'+vLabel+'</span></div>';
    h+='</div>';

    h+='<div class="legend">';
    h+='<span class="legend-lbl">Legend</span>';
    h+='<span class="legend-item" style="color:#8a8070"><svg width="14" height="14"><circle cx="7" cy="7" r="5" fill="#c9a84c"/></svg>&nbsp;Chord tone</span>';
    h+='<span class="legend-item" style="color:#8a8070"><svg width="14" height="14"><circle cx="7" cy="7" r="5" fill="#c9a84c"/><circle cx="7" cy="7" r="2" fill="#0d0c0a"/></svg>&nbsp;Root</span>';
    h+='<span class="legend-item" style="color:#5a7a5a"><svg width="14" height="14"><circle cx="7" cy="7" r="5" fill="none" stroke="#4a5a4a" stroke-width="1.2"/></svg>&nbsp;Scale tone (melody)</span>';
    h+='</div>';

    h+='<div class="section-title" style="color:'+accent+'">'+(vibe==='math'?'Angular Voicings':'Chord Voicings')+'</div>';
    h+='<div class="chords-grid">';
    cards.forEach(function(c){
      var diag=drawDiagram(c.frets,scaleSemi,c.chordSemi);
      var ttype=(vibe==='mix')?c.type:vibe;
      h+='<div class="chord-card" style="border-color:'+(vibe==='math'?'#1e1a2e':'var(--border)')+'">';
      h+='<div class="chord-name">'+c.note+c.sym+'</div>';
      h+='<div class="chord-type-tag '+ttype+'">'+c.degree+'</div>';
      h+=diag;
      h+='<div class="chord-intervals">'+c.iStr+'</div>';
      if (c.desc) h+='<div class="chord-desc">'+c.desc+'</div>';
      h+='</div>';
    });
    h+='</div>';

    h+='<div class="section-title" style="color:'+accent+'">Progressions</div>';
    h+='<div class="progressions-list">';
    progs.forEach(function(p){
      h+='<div class="progression-row">';
      h+='<span class="prog-label">'+p.label+'</span>';
      h+='<div class="prog-chords">';
      p.chords.forEach(function(c,idx){
        if (idx>0) h+='<span class="prog-arrow">&#8594;</span>';
        h+='<span class="prog-chord">'+c.name+'</span>';
      });
      h+='</div>';
      h+='<span class="prog-feel">'+p.feel+'</span>';
      h+='</div>';
    });
    h+='</div>';

    out.innerHTML=h;
    out.classList.add('visible');
  },100);
}

document.getElementById('generateBtn').addEventListener('click', generate);
generate();
</script>
</body>
</html>
